{% extends 'core/base.html' %}
{% block title %}Configuración de Preferencias{% endblock %}

{% block content %}
<div class="kpi-card">
    <h4 class="mb-4"><i class="fas fa-sliders-h text-primary"></i> Preferencias de Sustitución</h4>
    <div class="alert alert-info py-2 small">
        <i class="fas fa-info-circle"></i> Aquí puedes cambiar el producto recomendado por defecto (basado en margen) por otra alternativa disponible en tu stock.
    </div>
    
    <div class="table-responsive mt-3">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th style="width: 30%">Grupo Homogéneo</th>
                    <th style="width: 50%">Producto a dispensar (Preferencia)</th>
                    <th style="width: 10%">Activo</th>
                    <th style="width: 10%">Acción</th>
                </tr>
            </thead>
            <tbody>
                {% for item in lista_config %}
                <tr>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="grupo_hidden" value="{{ item.grupo }}">
                        
                        <td>
                            <div class="fw-bold text-dark">{{ item.grupo }}</div>
                            {% if not item.es_manual %}
                                <span class="badge bg-light text-muted border">
                                    <i class="fas fa-robot"></i> Auto (Margen {{ item.margen }}%)
                                </span>
                            {% else %}
                                <span class="badge bg-primary">
                                    <i class="fas fa-user-edit"></i> Manual
                                </span>
                            {% endif %}
                        </td>
                        
                        <td>
                            <select name="producto_elegido" class="form-select {% if item.es_manual %}border-primary fw-bold{% endif %}">
                                {% for opcion in item.opciones %}
                                    <option value="{{ opcion }}" {% if opcion == item.valor_actual %}selected{% endif %}>
                                        {{ opcion }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                        
                        <td>
                            <div class="form-check form-switch d-flex justify-content-center">
                                <input class="form-check-input" type="checkbox" name="activo" 
                                       {% if item.activo %}checked{% endif %}>
                            </div>
                        </td>
                        
                        <td>
                            <button type="submit" class="btn btn-sm btn-outline-success w-100">
                                <i class="fas fa-save"></i>
                            </button>
                        </td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}